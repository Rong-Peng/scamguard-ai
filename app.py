
import streamlit as st
import google.generativeai as genai

# è®¾ç½®é¡µé¢æ ‡é¢˜å’Œå›¾æ ‡
st.set_page_config(page_title="ScamGuard AI - åè¯ˆå†›å¸ˆ", page_icon="ğŸ›¡ï¸", layout="centered")

# ä¾§è¾¹æ ï¼šè¾“å…¥API Keyï¼ˆä¸ºäº†å®‰å…¨ï¼Œå®é™…éƒ¨ç½²æ—¶æˆ‘ä»¬ä¼šç”¨å¦ä¸€ç§æ–¹å¼ï¼Œè¿™é‡Œå…ˆé¢„ç•™ï¼‰
# å¦‚æœä½ è‡ªå·±éƒ¨ç½²ï¼Œåé¢ä¼šåœ¨åå°é…ç½® Secretsï¼Œä¸éœ€è¦ç”¨æˆ·å¡«
if "messages" not in st.session_state:
    st.session_state.messages = []

# é¡µé¢ä¸»UI
st.title("ğŸ›¡ï¸ ScamGuard AI æ™ºèƒ½åè¯ˆåˆ†æ")
st.markdown("### âš ï¸ ä¸ç¡®å®šå¯¹æ–¹æ˜¯ä¸æ˜¯éª—å­ï¼Ÿå‘ç»™æˆ‘ï¼Œæˆ‘å¸®ä½ æµ‹ã€‚")
st.info("ğŸ”’ éšç§æ‰¿è¯ºï¼šæ‚¨çš„èŠå¤©å†…å®¹ä»…ç”¨äºå®æ—¶åˆ†æï¼Œä¸ä¼šè¢«ä¿å­˜åˆ°æœåŠ¡å™¨ã€‚")

# è·å–ç”¨æˆ·è¾“å…¥çš„ API Key (åœ¨ Streamlit Cloud éƒ¨ç½²æ—¶ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ Secrets è‡ªåŠ¨è¯»å–ï¼Œè¿™é‡Œæ˜¯å¤‡ç”¨)
api_key = st.secrets.get("GEMINI_API_KEY") 

if not api_key:
    st.error("ç³»ç»Ÿæ­£åœ¨ç»´æŠ¤ä¸­ï¼ˆç¼ºå°‘API Keyï¼‰ï¼Œè¯·ç¨åå†è¯•ã€‚")
    st.stop()

# é…ç½® Gemini
genai.configure(api_key=api_key)

# ç³»ç»ŸæŒ‡ä»¤ (System Instruction) - å°±æ˜¯åˆšæ‰å’±ä»¬æ‰“ç£¨çš„é‚£å¥—
SYSTEM_PROMPT = """
ä½ æ˜¯ä¸€ä½æ‹¥æœ‰20å¹´ç»éªŒçš„çŠ¯ç½ªå¿ƒç†å­¦ä¸“å®¶å’Œåè¯ˆéª—è°ˆåˆ¤ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯åˆ†æç”¨æˆ·ä¸Šä¼ çš„èŠå¤©è®°å½•æˆ–æ–‡æœ¬ï¼Œè¯†åˆ«æ½œåœ¨çš„è¯ˆéª—è¡Œä¸ºï¼Œå¹¶æŒ‡å¯¼ç”¨æˆ·å¦‚ä½•å®‰å…¨åœ°éªŒè¯å¯¹æ–¹èº«ä»½ã€‚

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹é€»è¾‘æ­¥éª¤è¿›è¡Œæ€è€ƒå’Œè¾“å‡ºï¼š

1. **æ·±åº¦æ„å›¾è¯†åˆ«**ï¼šåˆ†ææ ¸å¿ƒåŠ¨æœºï¼ˆé’±ã€éšç§ã€æ€çŒªç›˜é“ºå«ï¼‰ã€å¿ƒç†æ“æ§æ‰‹æ®µï¼ˆç´§è¿«æ„Ÿã€æƒå¨å‹è¿«ã€å–æƒ¨ï¼‰å’Œé€»è¾‘çŸ›ç›¾ç‚¹ã€‚
2. **é£é™©è¯„åˆ†**ï¼š0-100åˆ†ã€‚
3. **ç”ŸæˆéªŒè¯æ€§å›å¤ï¼ˆå…³é”®ï¼‰**ï¼š
   - ç­–ç•¥Aï¼šè£…å‚»ç¤ºå¼± (Feigned Incompetence)
   - ç­–ç•¥Bï¼šä¸€è‡´æ€§æµ‹è¯• (Consistency Trap)
   - ç­–ç•¥Cï¼šåˆ‡æ–­æ“æ§æº (Breaking the Frame)

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ Markdown æ ¼å¼è¾“å‡ºï¼š

# ğŸ›¡ï¸ ScamGuard åˆ†ææŠ¥å‘Š

## ğŸ“Š ç»¼åˆé£é™©æŒ‡æ•°ï¼š[åˆ†æ•°]/100
**åˆ¤å®šç­‰çº§ï¼š** [å®‰å…¨ / å¯ç–‘ / æåº¦å±é™©]

## ğŸ‘ï¸ æ ¸å¿ƒåŠ¨æœºæ­ç§˜
**å¯¹æ–¹çœŸæ­£æƒ³è¦çš„æ˜¯ï¼š** [ä¸€å¥è¯çŠ€åˆ©æŒ‡å‡º]

## ğŸš© å¿ƒç†åšå¼ˆæ‰‹æ®µ
* **[æ‰‹æ®µåç§°]ï¼š** [è§£é‡Š]

## ğŸ’¬ å†›å¸ˆé”¦å›Šï¼šå¤åˆ¶è¿™å‡ å¥è¯å‘ç»™TA (éªŒè¯çœŸä¼ª)
**ğŸ¯ è¯æœ¯ 1 (è£…å‚»æµ‹è¯•)ï¼š**
> "[AIç”Ÿæˆçš„å…·ä½“å›å¤]"
* *é¢„æœŸååº”ï¼š* [è§£é‡Š]

**ğŸ¯ è¯æœ¯ 2 (è¯•æ¢åº•çº¿)ï¼š**
> "[AIç”Ÿæˆçš„å…·ä½“å›å¤]"
* *é¢„æœŸååº”ï¼š* [è§£é‡Š]

## ğŸ›‘ ä¸“å®¶æœ€ç»ˆå»ºè®®
[ç®€çŸ­å»ºè®®]
"""

# è¾“å…¥æ¡†
user_input = st.text_area("åœ¨æ­¤ç²˜è´´æ‚¨ä¸å¯¹æ–¹çš„èŠå¤©è®°å½•ï¼Œæˆ–è€…å¯¹æ–¹çš„ä¸ªäººç®€ä»‹...", height=200)

if st.button("å¼€å§‹å®‰å…¨æ£€æµ‹ ğŸš€", type="primary"):
    if not user_input:
        st.warning("è¯·å…ˆç²˜è´´èŠå¤©å†…å®¹å“¦ï¼")
    else:
        with st.spinner("æ­£åœ¨åˆ†æå¯¹æ–¹çš„å¿ƒç†å›¾è°±..."):
            try:
                # è°ƒç”¨ Gemini Pro æ¨¡å‹
                model = genai.GenerativeModel('gemini-1.5-flash') # flash æ¨¡å‹æ›´å¿«æ›´ä¾¿å®œï¼ˆå…è´¹é¢åº¦æ›´é«˜ï¼‰
                
                # æ‹¼æ¥ Prompt
                full_prompt = f"{SYSTEM_PROMPT}\n\nå¾…åˆ†æå†…å®¹ï¼š\n{user_input}"
                
                response = model.generate_content(full_prompt)
                
                # å±•ç¤ºç»“æœ
                st.markdown("---")
                st.markdown(response.text)
                
            except Exception as e:
                st.error(f"åˆ†æå‡ºé”™ï¼Œè¯·ç¨åå†è¯•: {e}")

# åº•éƒ¨å£°æ˜
st.markdown("---")
st.caption("Powered by Google Gemini | ScamGuard AI Â© 2024")